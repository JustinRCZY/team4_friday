<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>StreamlinePro | <%=title %></title>
    <%- include('./partials/head.ejs') %>
</head>
<body>

    <nav class="navbar">
        <div class="site-title">
            <a href="/scrumboard"><h1>Scrum Board</h1></a>
        </div>
        <ul>
            <li>
                <a href="#">Navigation Directory</a>
                <ul>
                    <li><a href="/scrumboard">Scrum Board</a></li>
                    <li><a href="/blogs">Product Backlog</a></li>
                </ul>
            </li>
        </ul>
    </nav>
    <div class="blogs content">
        <nav class="navbar" style="margin-bottom: 0px; border-bottom: 0px; padding-bottom: 0px; height: 30px; white-space: nowrap">
            <h2 style="display: flex; align-items: center; white-space: nowrap"><u>All Sprints</u>
                <ul style="padding-left: 50%; display: flex; list-style-type: none; width: 1200px;">
                        <li>                                       
                            <% if (sortStatusSprint) { %>
                                <p class="urgent" style="white-space: nowrap; padding: 0px 30px 0px 10px;"><a href="/sortsprint">Status (Not Started -> Complete)</a></p>
                            <% } else { %>
                                <p class="low" style="white-space: nowrap; padding: 0px 30px 0px 10px;"><a href="/sortsprint2">Status (Complete -> Not Started)</a></p>
                            <% } %>
                            <ul>
                                <% if (!sortStatusSprint) { %>
                                    <p style="white-space: nowrap; font-size: 16px;"><a href="/sortsprint">Status (Not Started -> Complete)</a></p>
                                <% } else { %>
                                    <p style="white-space: nowrap; font-size: 16px;"><a href="/sortsprint2">Status (Complete -> Not Started)</a></p>
                                <% } %>
                            </ul>
                        </li>
                    </ul>
              </h2>
            </nav>
        <table>
            <tr>
                <th><p style="font-size: 24px; color: #0000008b">&nbsp; &nbsp; &nbsp;</p></th>
                <th><p style="font-size: 24px; color: #0000008b; padding-right: 180px;">Sprint name</p></th>
                <th><p style="font-size: 24px; color: #0000008b">Status</p></th>
                <th><p style="font-size: 24px; color: #0000008b">Sprint dates</p></th>
                <th><p style="font-size: 24px; color: #8b8b8b8b">&nbsp;&nbsp;&nbsp;&nbsp;</p></th>
            </tr>
            <% if (sprints.length > 0) { %>
                <% sprints.forEach(sprint => { %>
                    <tr>
                        <td><a class="delete" data-doc="<%= sprint._id %>"><i class="fas fa-trash-alt"></i></a></td>
                        <td><a class="single" href="/scrumboard/<%= sprint._id %>"><p style="font-family: Calibri, sans-serif; font-size: 20px; padding-left: 10px; margin: 5px 0;"><%= sprint.sprintname %></p></a></td>
                        <td>
                            <p style="margin: 5px 0;">
                                <% if (new Date() > sprint.startdate & new Date() < sprint.enddate) { %>
                                    <scan class="medium">In-Progress</scan>
                                <% } else if (new Date() < sprint.startdate) { %>
                                    <scan class="urgent">Not Started</scan>
                                <% } else { %>
                                    <scan class="low">Completed</scan>
                                <% } %>
                            </p>
                        </td>
                        <td>
                            <scan><%= sprint.startdate.getDate() + "/" + (sprint.startdate.getMonth()+1) + "/" + sprint.startdate.getFullYear() + " --> " + sprint.enddate.getDate() + "/" + (sprint.enddate.getMonth()+1) + "/" + sprint.enddate.getFullYear() %></scan>
                        </td>
                        <td>                            
                            <% if (new Date() < sprint.startdate) { %>
                            <a class="single" href="/editsprint/<%= sprint._id %>"><i class="fas fa-edit"></i></a>
                            <% } %>
                            <a class="single" href="/burndown/<%= sprint._id %>"><i class="fas fa-chart-bar"></i></a>
                    </td>

                    </tr>
                <% }) %>
            <% } else { %>
                <tr>
                    <td><p style="padding-left: 28px;">&nbsp;</p></td>
                    <td><a>There are no sprints</a></td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
            <% } %>
                 
            <tr>
                <td>&nbsp;</td>
                <td><a href="/scrumboard/createSprint">+ New Sprint</a></td>
            </tr>
        </table>
    </div>
    <%- include('./partials/footer.ejs') %>
    <script>
        // this is used to delete
        // we do a.delete because we have an id-a object with a class delete
       // Select all elements with class 'delete'
        const trashcans = document.querySelectorAll('a.delete');

        // Add a click event listener to each 'delete' button
        trashcans.forEach(trashcan => {
            trashcan.addEventListener('click', (e) => {
                e.preventDefault(); // Prevent the default behavior of the anchor tag
                
                const endpoint = `/scrumboard/${trashcan.dataset.doc}`;
                
                fetch(endpoint, {
                    method: 'DELETE',
                })
                .then(response => response.json())
                .then(data => window.location.href = data.redirect)
                .catch(err => console.log(err));
            });
        });
        
    </script>


</body>
</html>
