<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>StreamlinePro | <%=title %></title>
    <%- include('./partials/head.ejs') %>
</head>
<body>
    <%- include('./partials/nav.ejs') %>
    <div class="blogs content">
        <nav class="navbar" style="margin-bottom: 0px; border-bottom: 0px; padding-bottom: 0px; height: 30px;">
            <h2 style="display: flex; align-items: center; white-space: nowrap; width: 1200px;"><u>All Tasks</u>
            <a href="/filter" style="padding-left: 55%;">Filter</a>
            <ul style="width: 1200px;">

                    <li>                                        
                        <% if (currentSort) { %>
                            <% if (sortPriority) { %>
                                <p class="urgent" style="white-space: nowrap; padding: 0px 25px 0px 10px;"><a href="/sort">Priority (Low -> High)</a></p>
                            <% } else { %>
                                <p class="urgent" style="white-space: nowrap; padding: 0px 25px 0px 10px;"><a href="/sort2">Priority (High -> Low)</a></p>
                            <% } %>
                        <% } else { %>
                            <% if (sortByDate) { %>
                                <p class="back" style="white-space: nowrap; padding: 0px 60px 0px 10px;"><a href="/sort-by-date">Date (Old -> New)</a></p>
                            <% } else { %>
                                <p class="back" style="white-space: nowrap; padding: 0px 60px 0px 10px;"><a href="/sort-by-date2">Date (New -> Old)</a></p>
                            <% } %>
                        <% } %>
                        <ul>
                            <% if (!(currentSort && sortPriority)) { %>
                            <li style="font-size: 16px;"><a href="/sort">Priority (Low -> High)</a></li>
                            <% } %>
                            <% if (!(currentSort && !sortPriority)) { %>
                            <li style="font-size: 16px;"><a href="/sort2">Priority (High -> Low)</a></li>
                            <% } %>
                            <% if (!(!currentSort && sortByDate)) { %>
                            <li style="font-size: 16px;"><a href="/sort-by-date">Date (Old -> New)</a></li>
                            <% } %>
                            <% if (!(!currentSort && !sortByDate)) { %>
                            <li style="font-size: 16px;"><a href="/sort-by-date2">Date (New -> Old)</a></li>
                            <% } %>
                        </ul>
                    </li>
                </ul>
          </h2>
        </nav>
        <table>
            <tr>
                <th><p style="font-size: 24px; color: #0000008b">&nbsp; &nbsp; &nbsp;</p></th>
                <th><p style="font-size: 24px; color: #0000008b; padding-right: 180px;">Task name</p></th>
                <th><p style="font-size: 24px; color: #0000008b">Tags</p></th>
                <th><p style="font-size: 24px; color: #0000008b">Priority</p></th>
                <th><p style="font-size: 24px; color: #0000008b">Story Point</p></th>
                <th><p style="font-size: 24px; color: #0000008b">&nbsp;&nbsp;&nbsp;&nbsp;</p></th>
            </tr>
            <% if (blogs.length > 0) { %>
                <% blogs.forEach(blog => { %>
                    <% if (blog.visibility === true) { %>
                        <tr>
                            <td><a class="delete" data-doc="<%= blog._id %>"><i class="fas fa-trash-alt"></i></a></td>
                            <td><a class="single" href="/blogs/<%= blog._id %>"><p style="font-family: Calibri, sans-serif; font-size: 20px; padding-left: 10px; margin: 5px 0;"><%= blog.tasknames %></p></a></td>
                            <td>
                                <p style="margin: 5px 0;">
                                    <% blog.tags.forEach(tag => { %>

                                        <% if (tag == "Front end") { %>
                                            <scan class="front"><%= tag %></scan><br>
                                        <% } else if (tag == "Back end") { %>
                                            <scan class="back"><%= tag %></scan><br>
                                        <% } else if (tag == "API") { %>
                                            <scan class="API"><%= tag %></scan>&nbsp;
                                        <% } else if (tag == "Database") { %>
                                            <scan class="database"><%= tag %></scan><br>
                                        <% } else if (tag == "Framework") { %>
                                            <scan class="framework"><%= tag %></scan><br>
                                        <% } else if (tag == "Testing") { %>
                                            <scan class="testing"><%= tag %></scan>
                                        <% } else if (tag == "UI") { %>
                                            <scan class="UI"><%= tag %></scan>&nbsp;
                                        <% } else { %>
                                            <scan class="UX"><%= tag %></scan>&nbsp;
                                        <% } %>
                                        
                                    <% }) %>
                                </p>
                            </td>
                            <td>
                                <p style="margin: 5px 0;">
                                    <% if (blog.priority === "Urgent") { %>
                                        <scan class="urgent"><%= blog.priority %></scan>
                                    <% } else if (blog.priority === "Important") { %>
                                        <scan class="important"><%= blog.priority %></scan>
                                    <% } else if (blog.priority === "Medium") { %>
                                        <scan class="medium"><%= blog.priority %></scan>
                                    <% } else { %>
                                        <scan class="low"><%= blog.priority %></scan>
                                    <% } %>
                                </p>
                            </td>
                            <td><p style="font-family: Calibri, sans-serif; font-size: 20px; margin: 5px 0;"><%= blog.storypoint %></p></td>
                            <td><a class="single" href="/test/<%= blog._id %>"><i class="fas fa-edit"></i></a></td>
                        </tr>
                    <% } %>
                <% }) %>
            <% } else { %>
                <tr>
                    <td><p style="padding-left: 28px;">&nbsp;</p></td>
                    <td><a>There are no tasks</a></td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
            <% } %>
                 
            <tr>
                <td>&nbsp;</td>
                <td><a href="/blogs/create">+ New Task</a></td>
            </tr>
        </table>
    </div>
    <%- include('./partials/footer.ejs') %>
    <script>
        // this is used to delete
        // we do a.delete because we have an id-a object with a class delete
       // Select all elements with class 'delete'
        const trashcans = document.querySelectorAll('a.delete');

        // Add a click event listener to each 'delete' button
        trashcans.forEach(trashcan => {
            trashcan.addEventListener('click', (e) => {
                e.preventDefault(); // Prevent the default behavior of the anchor tag
                
                const endpoint = `/blogs/${trashcan.dataset.doc}`;
                
                fetch(endpoint, {
                    method: 'DELETE',
                })
                .then(response => response.json())
                .then(data => window.location.href = data.redirect)
                .catch(err => console.log(err));
            });
        });
        
    </script>
</body>
</html>